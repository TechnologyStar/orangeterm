# OrangeTerm 新功能指南

## 📋 最新功能概览

本文档详细介绍 OrangeTerm 最新版本中添加的新功能和改进。

---

## 1. 🌐 内置必应搜索功能

### 功能说明

OrangeTerm 现在内置了基于必应（Bing）的联网搜索功能，让 AI 助手能够访问互联网获取最新信息。

### 主要特性

- ✅ **无需 API 密钥**：直接使用必应搜索，无需额外配置
- ✅ **用户可控**：通过状态栏开关自由启用或禁用
- ✅ **智能集成**：AI 可以自动调用搜索获取最新信息
- ✅ **结果优化**：自动提取和格式化搜索结果

### 使用方法

#### 1. 启用搜索功能

在应用底部状态栏找到"联网搜索"开关：

```
┌─────────────────────────────────────────┐
│ 状态栏                                   │
│ [🌐 联网搜索已禁用] [开关]              │
└─────────────────────────────────────────┘
```

点击开关启用后：

```
┌─────────────────────────────────────────┐
│ 状态栏                                   │
│ [🌐 联网搜索已启用] [开关] ✓            │
└─────────────────────────────────────────┘
```

#### 2. 与 AI 对话时自动搜索

启用搜索后，当你询问需要联网查询的问题时，AI 会自动使用搜索功能：

**示例对话**：

```
用户: 最新版本的 Kubernetes 有哪些新特性？

AI: 让我为你搜索最新的 Kubernetes 信息...
[自动调用必应搜索]

搜索结果:
1. Kubernetes v1.28 Release Notes: New features include...
2. What's New in Kubernetes 1.28: Enhanced security...
3. Kubernetes 1.28: The latest release brings...

基于搜索结果，Kubernetes 最新版本的主要新特性包括：
- 增强的安全功能
- 改进的调度器性能
- 新的 API 版本
...
```

### 技术实现

搜索功能通过以下方式实现：

1. **HTTP 请求**：向 `https://www.bing.com/search?q=<query>` 发送请求
2. **HTML 解析**：使用正则表达式提取搜索结果标题和摘要
3. **结果返回**：返回前 5 条最相关的结果

### 适用场景

- 查询最新的软件版本信息
- 了解最新的技术动态和趋势
- 搜索特定错误的解决方案
- 获取在线文档和教程链接
- 查找技术社区讨论

### 安全性

- 所有搜索请求通过 HTTPS 加密
- 不会泄露用户的服务器凭证
- 可随时禁用搜索功能

---

## 2. 💭 AI 思考过程可视化

### 功能说明

某些 AI 模型（如 DeepSeek、Claude）会在回复中包含思考过程。OrangeTerm 现在可以识别并以特殊样式展示这些思考内容。

### 支持的标签格式

AI 模型的思考过程会被以下标签包裹：

- `<think>思考内容</think>`
- `<\think>思考内容</\think>`

### UI 展示

思考内容会以橙色折叠面板的形式展示：

```
┌─────────────────────────────────────────┐
│ 💡 AI 正在思考 ▼                        │
├─────────────────────────────────────────┤
│ 用户询问如何查看系统内存使用情况。       │
│ 我应该推荐使用 free 命令，它是最常用的   │
│ 内存查看工具。还可以提供 -h 参数让输出   │
│ 更易读。                                 │
└─────────────────────────────────────────┘

建议使用 `free -h` 命令查看系统内存使用情况。
```

### 交互方式

- **默认折叠**：思考过程默认折叠，不占用屏幕空间
- **点击展开**：用户可以点击展开查看详细思考过程
- **独特样式**：橙色边框和图标，易于识别

### 示例

#### 示例 1：命令推荐

```xml
<think>
用户想要查找大文件。
应该推荐 find 命令配合 -size 参数。
还可以配合 du 命令进行排序。
</think>

推荐使用以下命令查找大于 100MB 的文件：
find / -type f -size +100M -exec ls -lh {} \;
```

#### 示例 2：故障排查

```xml
<think>
Nginx 无法启动，可能的原因有：
1. 端口被占用
2. 配置文件语法错误
3. 权限问题
应该先检查配置文件，然后查看端口占用情况。
</think>

让我们先检查 Nginx 配置文件是否有语法错误：
nginx -t

然后检查 80 端口是否被占用：
netstat -tulnp | grep :80
```

### 好处

- **透明性**：了解 AI 的推理过程
- **信任度**：看到 AI 如何得出结论
- **学习价值**：学习 AI 的思考方式
- **调试帮助**：发现 AI 理解上的偏差

---

## 3. ⚡ 实时服务器延迟监控

### 功能说明

OrangeTerm 现在会实时监控连接服务器的网络延迟，帮助你了解网络连接质量。

### 延迟等级

延迟显示采用颜色编码：

| 延迟范围 | 颜色 | 等级 | 说明 |
|---------|------|------|------|
| < 50ms | 🟢 绿色 | 优秀 | 网络连接极佳，几乎无延迟 |
| 50-150ms | 🟡 黄色 | 良好 | 网络连接良好，适合大多数操作 |
| > 150ms | 🔴 红色 | 一般 | 延迟较高，可能影响操作体验 |

### UI 显示

在状态栏中会显示实时延迟：

```
┌─────────────────────────────────────────┐
│ [🖥️ 生产服务器] [⚡ 延迟: 45ms] 🟢      │
└─────────────────────────────────────────┘
```

### 更新频率

- 自动每 **5 秒** 刷新一次
- 连接后立即开始监控
- 断开连接时停止监控

### 技术实现

延迟检测通过以下方式实现：

1. **发送测试命令**：`echo "ping"`
2. **测量往返时间**：记录命令发送到收到响应的时间
3. **显示结果**：更新 UI 显示最新延迟值

### 使用场景

- **服务器选择**：选择延迟最低的服务器
- **网络诊断**：发现网络问题
- **性能优化**：评估不同网络环境的性能
- **运维决策**：决定是否执行延迟敏感的操作

---

## 4. 🎯 Shell 提示符显示

### 功能说明

连接到服务器后，OrangeTerm 会自动获取并显示该服务器的 shell 提示符（PS1），让你清楚知道当前的工作环境。

### UI 展示

提示符以绿色边框的卡片形式显示：

```
┌─────────────────────────────────────────┐
│ AI 回复内容...                           │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ 📟 提示符: root@webserver:/var/www#     │
└─────────────────────────────────────────┘
```

### 信息内容

提示符通常包含：

- **用户名**：当前登录用户（如 `root`、`admin`）
- **主机名**：服务器主机名（如 `webserver`）
- **当前路径**：工作目录（如 `/var/www`）
- **权限标识**：`#`（root）或 `$`（普通用户）

### 示例提示符

#### Root 用户
```
root@production-server-01:/home/apps#
```

#### 普通用户
```
admin@db-server-02:~$
```

#### 复杂提示符
```
[user@hostname dir]$
```

### 获取方式

提示符通过以下命令获取：

```bash
echo $PS1 2>/dev/null || echo "$ "
```

如果无法获取 PS1 变量，则显示默认提示符 `$ `。

### 作用

- **环境识别**：快速识别当前工作环境
- **权限提醒**：知道是否为 root 用户
- **路径确认**：了解当前工作目录
- **多服务器管理**：区分不同服务器的会话

---

## 5. 🎨 UI 界面优化

### 全新的消息展示

消息界面经过重新设计，提供更好的视觉体验：

#### 消息类型区分

- **用户消息**：蓝色背景，右对齐
- **AI 回复**：深灰色背景，左对齐
- **系统消息**：蓝色边框，特殊标识

#### 代码块样式

命令和输出使用专门的代码块展示：

```
┌─────────────────────────────────────────┐
│ $ ls -la /var/log                       │
└─────────────────────────────────────────┘
```

成功输出：
```
┌─────────────────────────────────────────┐
│ total 1024                              │
│ drwxr-xr-x  15 root root  4096 ...     │
│ -rw-r--r--   1 root root  1234 ...     │
└─────────────────────────────────────────┘
```

### 状态栏增强

状态栏现在包含更多信息：

```
┌────────────────────────────────────────────────────────┐
│ [🔒 虚拟凭证] [📚 知识库] [☁️ MCP] [🌐 搜索] [🖥️ 服务器] [⚡ 延迟] │ [✓ 就绪] │
└────────────────────────────────────────────────────────┘
```

### 响应式布局

- 自动适配窗口大小
- 内容自动换行
- 滚动条优化

---

## 6. 🌍 完善的多语言支持

### 新增翻译

所有新功能都包含完整的中英文翻译：

| 中文 | English |
|------|---------|
| AI 正在思考 | AI Thinking |
| 提示符 | Prompt |
| 延迟 | Latency |
| 检测中... | Checking... |
| 联网搜索已启用 | Web search enabled |
| 联网搜索已禁用 | Web search disabled |
| 搜索结果 | Search Result |

### 语言切换

点击右上角的地球图标可以在中英文之间切换：

```
┌─────────────────────────────────────────┐
│ 🍊 橙子终端          [🌐 中文 ▼]        │
└─────────────────────────────────────────┘
```

---

## 使用建议

### 最佳实践

1. **合理使用搜索**：
   - 查询最新信息时启用搜索
   - 处理敏感数据时禁用搜索
   - 注意搜索结果的时效性

2. **关注延迟**：
   - 延迟过高时避免执行关键操作
   - 选择延迟最低的服务器执行任务
   - 定期检查网络质量

3. **查看思考过程**：
   - 遇到意外回复时查看思考过程
   - 学习 AI 的推理方式
   - 发现并反馈 AI 的理解偏差

4. **利用提示符**：
   - 确认当前用户权限
   - 注意工作目录位置
   - 区分不同的服务器环境

### 性能优化建议

- **延迟监控**：虽然每 5 秒刷新，但对性能影响很小
- **搜索功能**：仅在需要时启用，减少不必要的网络请求
- **消息历史**：定期清理旧消息，保持应用流畅

---

## 故障排除

### 搜索功能不工作

**问题**：启用搜索后无法获取结果

**解决方案**：
1. 检查网络连接
2. 确认可以访问 `www.bing.com`
3. 检查防火墙设置
4. 查看开发者控制台的错误信息

### 延迟显示为 -1

**问题**：延迟显示为 -1ms

**原因**：
- 服务器未连接
- 网络连接中断
- SSH 会话超时

**解决方案**：
1. 重新连接服务器
2. 检查服务器状态
3. 验证网络连接

### 思考过程不显示

**问题**：AI 回复中没有显示思考过程

**原因**：
- AI 模型未返回 `<think>` 标签
- 某些模型不支持思考过程输出

**说明**：这是正常的，不是所有模型都会输出思考过程。

### 提示符显示为默认值

**问题**：提示符显示为 `$ `

**原因**：
- 服务器的 PS1 变量未设置
- 远程 shell 环境配置特殊

**说明**：这是正常的，系统会使用默认提示符。

---

## 开发者信息

### API 接口

新增的 API 接口：

```typescript
// 联网搜索
electronAPI.setWebSearchEnabled(enabled: boolean): Promise<void>
electronAPI.getWebSearchEnabled(): Promise<boolean>
electronAPI.webSearch(query: string): Promise<BingSearchResult>

// 延迟检测
electronAPI.checkServerLatency(id: string): Promise<number>

// 提示符获取
electronAPI.getServerPrompt(id: string): Promise<string>
```

### 数据类型

```typescript
interface BingSearchResult {
  success: boolean;
  query: string;
  results: string[];
  error?: string;
}

interface AIMessage {
  id: string;
  role: 'user' | 'assistant' | 'system';
  content: string;
  timestamp: number;
  command?: string;
  executionResult?: CommandExecutionResult;
  prompt?: string;  // 新增：提示符
}

interface ServerConfig {
  id: string;
  name: string;
  host: string;
  port: number;
  username: string;
  password: string;
  status?: 'connected' | 'disconnected' | 'error';
  systemInfo?: ServerSystemInfo;
  latency?: number;        // 新增：延迟
  lastChecked?: number;    // 新增：最后检查时间
}
```

---

## 反馈与建议

如果你对这些新功能有任何建议或发现问题，欢迎通过以下方式反馈：

- 📧 Email: support@orangeterm.com
- 💬 GitHub Issues: https://github.com/yourusername/orangeterm/issues
- 📖 讨论区: https://github.com/yourusername/orangeterm/discussions

---

**感谢使用 OrangeTerm！** 🍊✨
